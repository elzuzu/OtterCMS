import{j as e}from"./vendor-ui-CtvHukzg.js";import{D as s}from"./DattaPageTitle-T82UHXFU.js";import{r as a}from"./vendor-data-BY55b65u.js";import{d as r,D as l,a as t}from"./main-BtLJocfP.js";import{D as n}from"./DattaModal-BlJ6BfOc.js";import"./vendor-react-DjGYZWH8.js";function i({user:s}){const[i,o]=a.useState(null),[d,c]=a.useState(""),[m,u]=a.useState({name:"",color:"#6366f1",width:"2px",environment:"custom",glow:""}),[x,p]=a.useState(""),[h,j]=a.useState(!1),[v,f]=a.useState(!1),[g,b]=a.useState(!1),[N,w]=a.useState([]),[C,y]=a.useState(!1),S=r.constructor.getEnvironmentTemplates();a.useEffect((()=>(T(),r.subscribe((e=>{o(e),e.template&&S[e.template]&&c(e.template)})))),[]);const T=async()=>{await A(),await E(),y(r.isDegraded())},A=async()=>{const e=r.getCurrentTemplate();e&&(o(e),e.template&&S[e.template]&&c(e.template))},E=async()=>{const e=await r.getHistory(10);e.success&&(w(e.data||[]),e.degradedMode&&y(!0))},k=async()=>{if(!window.confirm("Voulez-vous essayer de r√©parer la configuration de bordure ?"))return;j(!0);const e=await r.repairConfiguration();e.success?(p("Configuration r√©par√©e avec succ√®s"),y(!1),await T()):p(`Erreur de r√©paration: ${e.error}`),j(!1)};return"admin"!==s.role?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsx("i",{className:"feather icon-lock mb-3",style:{fontSize:"3rem",color:"var(--pc-text-muted)"}}),e.jsx("h5",{children:"Acc√®s Restreint"}),e.jsx("p",{className:"text-muted",children:"La configuration des templates de bordure est r√©serv√©e aux administrateurs."}),i&&e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Configuration actuelle :"})," ",i.name,e.jsx("br",{}),e.jsxs("small",{children:["Environnement : ",i.environment]})]}),C&&e.jsxs("div",{className:"degraded-mode-alert",children:[e.jsx("i",{className:"feather icon-alert-triangle me-2"}),e.jsx("strong",{children:"Mode d√©grad√© :"})," Configuration de base de donn√©es non disponible"]})]})}):e.jsxs("div",{className:"border-template-admin",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h5",{className:"mb-0",children:"üåç Configuration Globale - Templates de Bordure"}),e.jsx("small",{className:"text-muted",children:"Cette configuration s'applique imm√©diatement √† tous les utilisateurs connect√©s"})]}),e.jsxs("div",{className:"card-body",children:[C&&e.jsxs("div",{className:"degraded-mode-alert d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsx("i",{className:"feather icon-alert-triangle me-2"}),e.jsx("strong",{children:"Mode d√©grad√© :"})," Base de donn√©es non disponible. Les modifications ne seront pas persistantes."]}),e.jsx(l,{variant:"outline-warning",size:"sm",onClick:k,disabled:h,children:"R√©parer"})]}),x&&e.jsx(t,{type:x.includes("succ√®s")||x.includes("sauvegard√©e")||x.includes("r√©par√©e")?"success":"danger",dismissible:!0,onClose:()=>p(""),children:x}),i&&e.jsx("div",{className:"alert alert-info mb-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("strong",{children:"Configuration actuelle :"})," ",i.name,e.jsx("br",{}),e.jsxs("small",{children:["Environnement : ",i.environment," | Couleur : ",i.color," | Largeur : ",i.width,C&&" (Mode d√©grad√©)"]})]}),e.jsx("div",{className:"border-preview active",style:{width:"80px",height:"50px",border:`${i.width} solid ${i.color}`,boxShadow:i.glow||"none"}})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:"Templates d'Environnement"}),e.jsx("div",{className:"template-grid",children:Object.entries(S).map((([s,a])=>e.jsxs("div",{className:"template-card "+(d===s?"selected":""),onClick:()=>(e=>{c(e);const s=S[e];s&&u({name:s.name,color:s.color,width:s.width,environment:s.environment,glow:s.glow||""})})(s),children:[e.jsx("div",{className:"template-preview",style:{border:`${a.width} solid ${a.color}`,boxShadow:a.glow||"none"},children:"Aper√ßu"}),e.jsx("div",{className:"template-name",children:a.name}),e.jsx("div",{className:"template-description",children:a.description})]},s)))})]}),e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsx(l,{variant:"primary",onClick:async()=>{if(!d)return void p("Veuillez s√©lectionner un template");j(!0),p("");const e=S[d];if(!e)return p("Template non trouv√©"),void j(!1);const s=await r.saveTemplate({...e,template:d});p(s.success?s.message:s.error),await E(),j(!1)},disabled:h||!d,children:h?"Application...":"Appliquer √† tous les utilisateurs"}),e.jsx(l,{variant:"secondary",onClick:()=>f(!0),disabled:h,children:"Cr√©er un template personnalis√©"}),e.jsx(l,{variant:"outline-secondary",onClick:()=>b(!0),disabled:h,children:"Voir l'historique"}),e.jsx(l,{variant:"outline-danger",onClick:async()=>{if(!window.confirm("Voulez-vous vraiment remettre la bordure par d√©faut (aucune bordure) ?"))return;j(!0);const e=S.default,s=await r.saveTemplate({...e,template:"default"});p(s.success?"Configuration remise par d√©faut":s.error),s.success&&(c("default"),await E()),j(!1)},disabled:h,children:"Remettre par d√©faut"}),C&&e.jsx(l,{variant:"warning",onClick:k,disabled:h,children:h?"R√©paration...":"R√©parer la configuration"})]})]})]}),e.jsxs(n,{open:v,onClose:()=>f(!1),title:"Cr√©er un Template Personnalis√©",size:"md",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Nom du template *"}),e.jsx("input",{type:"text",className:"form-control",value:m.name,onChange:e=>u((s=>({...s,name:e.target.value}))),placeholder:"Ex: Mon environnement",maxLength:50})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Couleur *"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"color",className:"form-control form-control-color",value:m.color,onChange:e=>u((s=>({...s,color:e.target.value})))}),e.jsx("input",{type:"text",className:"form-control",value:m.color,onChange:e=>u((s=>({...s,color:e.target.value}))),placeholder:"#ff0000"})]}),e.jsx("small",{className:"form-text text-muted",children:'Couleur hexad√©cimale ou "transparent"'})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Largeur *"}),e.jsxs("select",{className:"form-select",value:m.width,onChange:e=>u((s=>({...s,width:e.target.value}))),children:[e.jsx("option",{value:"0px",children:"Aucune (0px)"}),e.jsx("option",{value:"1px",children:"Fine (1px)"}),e.jsx("option",{value:"2px",children:"Moyenne (2px)"}),e.jsx("option",{value:"3px",children:"√âpaisse (3px)"}),e.jsx("option",{value:"4px",children:"Tr√®s √©paisse (4px)"}),e.jsx("option",{value:"5px",children:"Extra √©paisse (5px)"})]})]})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Effet de lueur (optionnel)"}),e.jsx("input",{type:"text",className:"form-control",value:m.glow,onChange:e=>u((s=>({...s,glow:e.target.value}))),placeholder:"Ex: 0 0 10px #ff0000"}),e.jsx("small",{className:"form-text text-muted",children:"Format CSS box-shadow (ex: 0 0 10px #couleur)"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Aper√ßu"}),e.jsx("div",{className:"border-preview",style:{border:`${m.width} solid ${m.color}`,boxShadow:m.glow||"none",height:"60px",display:"flex",alignItems:"center",justifyContent:"center"},children:m.name||"Template personnalis√©"})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(l,{variant:"secondary",onClick:()=>f(!1),children:"Annuler"}),e.jsx(l,{variant:"primary",onClick:async()=>{j(!0),p("");const e=r.constructor.validateTemplate(m);if(!e.isValid)return p(`Erreurs de validation: ${e.errors.join(", ")}`),void j(!1);const s={...m,template:"custom",name:m.name.trim()},a=await r.saveTemplate(s);p(a.success?a.message:a.error),a.success&&(f(!1),c("custom"),await E()),j(!1)},disabled:h||!m.name.trim(),children:h?"Cr√©ation...":"Cr√©er et Appliquer"})]})]}),e.jsxs(n,{open:g,onClose:()=>b(!1),title:"Historique des Modifications",size:"lg",children:[C&&e.jsxs("div",{className:"degraded-mode-alert mb-3",children:[e.jsx("i",{className:"feather icon-info me-2"}),"Historique non disponible en mode d√©grad√©"]}),0===N.length?e.jsx("p",{className:"text-muted text-center py-4",children:C?"Historique non disponible en mode d√©grad√©":"Aucun historique disponible"}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Template"}),e.jsx("th",{children:"Modifi√© par"}),e.jsx("th",{children:"Aper√ßu"})]})}),e.jsx("tbody",{children:N.map(((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("small",{children:new Date(s.modifiedAt).toLocaleString("fr-FR")})}),e.jsxs("td",{children:[e.jsx("strong",{children:s.name}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:s.environment})]}),e.jsx("td",{children:e.jsx("small",{children:s.modifiedBy||"Syst√®me"})}),e.jsx("td",{children:e.jsx("div",{style:{border:`${s.width} solid ${s.color}`,boxShadow:s.glow||"none",width:"40px",height:"25px",borderRadius:"2px"}})})]},a)))})]})})]})]})}function o({user:a}){return e.jsxs("div",{className:"pc-content",children:[e.jsx(s,{title:"Configuration des Templates"}),e.jsx(i,{user:a})]})}export{o as default};
