import{j as e}from"./vendor-ui-CtvHukzg.js";import{r}from"./vendor-data-BY55b65u.js";import{u as t}from"./useTimedMessage-3v5eabB6.js";import{u as s,D as a,a as o}from"./main-BtLJocfP.js";import{D as i}from"./DattaPageTitle-T82UHXFU.js";import{D as n}from"./DattaCard-Ca8oAgyz.js";import{D as c}from"./DattaNetworkDataTable-CKoFfAgq.js";import"./vendor-react-DjGYZWH8.js";const d=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"})}),l=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"}),e.jsx("path",{fillRule:"evenodd",d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"})]});function u(){const[u,m]=r.useState([]),[h,p]=r.useState([]),[g,v]=r.useState(""),[x,f]=r.useState(0),[y,w]=r.useState([]),[j,C]=r.useState(null),{message:q,setTimedMessage:M,clearMessage:k}=t(),[z,E]=r.useState(!0),[A,S]=r.useState(!1),[b,D]=r.useState(null),{performSync:V}=s(),N=r.useRef(!0),I=r.useCallback((async()=>{try{const e=await window.api.getCategories();if(e&&e.success&&Array.isArray(e.data)){const r=[],t=[],s=e.data;s.map((e=>({...e,isMasque:1===e.deleted}))).sort(((e,r)=>(e.ordre||0)-(r.ordre||0))).forEach((e=>{e.isMasque?t.push(e):r.push(e)})),m(r),p(t),D(null),0!==s.length||N.current||M({text:"Aucune catégorie trouvée. Commencez par en créer une.",type:"info"}),N.current=!1,await V()}else{const r=e&&e.error?e.error:"Format de réponse invalide ou échec du chargement.";D(r),M({text:`Erreur chargement catégories: ${r}`,type:"error"}),m([]),p([])}}catch(e){D(e.message),M({text:`Erreur critique lors du chargement: ${e.message}`,type:"error"}),m([]),p([])}}),[M,V]);r.useEffect((()=>{I()}),[I]);const T=()=>{v("");const e=[...u,...h],r=e.length>0?Math.max(0,...e.map((e=>e.ordre||0))):-10;f(r+10),w([]),C(null),k()};return e.jsxs("div",{className:"pc-content",children:[e.jsx(i,{title:"Gestion des catégories"}),e.jsx(n,{children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs(a,{variant:"primary",onClick:()=>{T(),setShowAddForm(!0)},children:[e.jsx(d,{})," Nouvelle catégorie"]}),e.jsx(a,{variant:"outline-secondary",onClick:()=>S(!A),children:A?"Masquer les catégories archivées":"Afficher les catégories archivées"})]}),q&&e.jsx(o,{type:q.type,className:"mb-3",children:q.text}),e.jsx(c,{data:A?h:u,columns:[{title:"Nom",dataIndex:"nom",key:"nom",sorter:!0},{title:"Ordre",dataIndex:"ordre",key:"ordre",sorter:!0},{title:"Champs",dataIndex:"champs",key:"champs",render:e=>(null==e?void 0:e.length)||0},{title:"Actions",key:"actions",render:(r,t)=>e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx(a,{variant:"outline-primary",size:"sm",onClick:()=>{return C(e=t),v(e.nom),f(e.ordre||0),w([...e.champs||[]].map((e=>({...e,maxLength:"text"===e.type&&void 0!==e.maxLength?e.maxLength:null,afficherEnTete:e.afficherEnTete||!1,options:Array.isArray(e.options)?e.options:[],formule:e.formule||""}))).sort(((e,r)=>(e.ordre||0)-(r.ordre||0)))),k(),void window.scrollTo({top:0,behavior:"smooth"});var e},children:e.jsx(EditIcon,{})}),t.isMasque?e.jsx(a,{variant:"outline-success",size:"sm",onClick:()=>(async e=>{if(window.confirm("Êtes-vous sûr de vouloir démasquer cette catégorie ?")){E(!0);try{const r=h.find((r=>r.id===e));if(!r)return M({text:"Catégorie à démasquer non trouvée.",type:"error"}),void E(!1);const t={...r,deleted:0};delete t.isMasque;const s=await window.api.updateCategorie(t);s.success?(M({text:"Catégorie démasquée avec succès!",type:"success"}),await I()):M({text:`Erreur démasquage: ${s.error||"Vérifiez que l'API supporte le démasquage."}`,type:"error"})}catch(r){M({text:`Erreur: ${r.message}`,type:"error"})}finally{E(!1)}}})(t.id),children:"Restaurer"}):e.jsx(a,{variant:"outline-danger",size:"sm",onClick:()=>(async e=>{if(window.confirm("Êtes-vous sûr de vouloir masquer cette catégorie ? Elle ne sera plus proposée pour les nouveaux individus et ses champs ne seront plus modifiables sur les individus existants via son onglet dédié.")){E(!0);try{const r=await window.api.deleteCategorie(e);r.success?(M({text:"Catégorie masquée avec succès.",type:"success"}),await I(),j&&j.id===e&&T()):M({text:`Erreur masquage: ${r.error||"Problème inconnu"}`,type:"error"})}catch(r){M({text:`Erreur: ${r.message}`,type:"error"})}finally{E(!1)}}})(t.id),children:e.jsx(l,{})})]})}],loading:z,error:b,onLoadData:I,refreshInterval:3e4,maxRetries:3,pagination:{currentPage:1,itemsPerPage:10,totalItems:(A?h:u).length}})]})})]})}export{u as default};
