import{j as e}from"./vendor-ui-CtvHukzg.js";import{r as s}from"./vendor-data-BY55b65u.js";import{c as a,a as r,D as t}from"./main-BtLJocfP.js";function n({columns:s=[],data:a=[],getRowKey:r,sortConfig:t,onSort:n,columnFilters:i={},onColumnFilterChange:l,title:c="Données",actions:o,page:d=0,rowsPerPage:m=10,onPageChange:h,onRowsPerPageChange:u}){const x=r||((e,s)=>e.id||s),j=a.length,g=Math.ceil(j/m),f=d*m+1,p=Math.min(f+m-1,j),v=a.slice(d*m,d*m+m);return e.jsxs("div",{className:"card table-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h5",{children:c||"Données"}),e.jsx("div",{className:"card-header-right",children:o})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover table-sm data-table",width:"100%",children:[e.jsxs("thead",{children:[e.jsx("tr",{children:s.map((s=>e.jsxs("th",{onClick:s.sortable?()=>{return e=s.key,void(n&&n(e));var e}:void 0,className:s.sortable?(null==t?void 0:t.key)===s.key?"descending"===t.direction?"sorting_desc":"sorting_asc":"sorting":"",style:{cursor:s.sortable?"pointer":"default",...s.thStyle||{}},children:[s.header,s.sortable&&e.jsx("i",{className:"feather icon-chevron-down ms-1"})]},s.key||s.header)))}),l&&e.jsx("tr",{className:"filter-row",children:s.map((s=>e.jsx("th",{style:s.thStyle,children:s.filterable&&e.jsx("input",{type:"text",className:"form-control form-control-sm",value:i[s.key]||"",onChange:e=>{return a=s.key,r=e.target.value,void(l&&l({...i,[a]:r}));var a,r}})},`filter-${s.key||s.header}`)))})]}),e.jsx("tbody",{children:v.map(((a,r)=>e.jsx("tr",{children:s.map((s=>e.jsx("td",{style:s.tdStyle,children:s.render?s.render(a):a[s.accessor]},s.key||s.header)))},x(a,r))))})]})}),j>m&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"dataTables_info",children:["Affichage de ",f," à ",p," sur ",j," entrées"]}),e.jsxs("div",{className:"dataTables_paginate paging_simple_numbers",children:[e.jsx("a",{className:"paginate_button previous "+(0===d?"disabled":""),onClick:()=>h&&h(d-1),children:"Préc."}),Array.from({length:g}).map(((s,a)=>e.jsx("a",{className:"paginate_button "+(a===d?"current":""),onClick:()=>h&&h(a),children:a+1},a))),e.jsx("a",{className:"paginate_button next "+(d+1>=g?"disabled":""),onClick:()=>h&&h(d+1),children:"Suiv."})]}),u&&e.jsx("div",{className:"ms-3",children:e.jsx("select",{className:"form-select form-select-sm",value:m,onChange:e=>u(parseInt(e.target.value,10)),children:[10,25,50,100].map((s=>e.jsxs("option",{value:s,children:[s," / page"]},s)))})})]})]})]})}function i({onLoadData:i,refreshInterval:l=6e4,maxRetries:c=3,...o}){const[d,m]=s.useState([]),[h,u]=s.useState(!0),[x,j]=s.useState(null),[g,f]=s.useState(0),[p,v]=s.useState(null),{addOperation:b,updateOperation:y,removeOperation:N}=a(),k=s.useCallback((async(e=!0)=>{let s=null;e&&(s=b({description:"Chargement des données...",status:"running"}));try{u(!0),j(null);const e=await i();m(e),f(0),v(new Date),s&&(y(s,{status:"completed",description:"Données chargées"}),setTimeout((()=>N(s)),2e3))}catch(a){if(j(a.message),f((e=>e+1)),s&&(y(s,{status:"error",description:"Erreur de chargement",error:a.message}),setTimeout((()=>N(s)),5e3)),g<c){const e=Math.min(1e3*Math.pow(2,g),1e4);setTimeout((()=>k(!1)),e)}}finally{u(!1)}}),[i,g,c,b,y,N]);if(s.useEffect((()=>{if(!l||x)return;const e=setInterval((()=>{k(!1)}),l);return()=>clearInterval(e)}),[k,l,x]),s.useEffect((()=>{k()}),[]),x&&g>=c)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body text-center py-5",children:[e.jsx("div",{className:"avtar avtar-xl bg-light-danger mb-4",children:e.jsx("i",{className:"feather icon-wifi-off f-36"})}),e.jsx("h5",{className:"mb-3",children:"Impossible de charger les données"}),e.jsxs(r,{type:"danger",className:"mb-3",children:["Erreur réseau: ",x]}),e.jsxs("div",{className:"d-flex gap-2 justify-content-center",children:[e.jsxs(t,{variant:"primary",onClick:()=>{f(0),k()},children:[e.jsx("i",{className:"feather icon-refresh-cw me-2"}),"Réessayer"]}),e.jsxs(t,{variant:"secondary",onClick:()=>window.location.reload(),children:[e.jsx("i",{className:"feather icon-rotate-ccw me-2"}),"Recharger l'application"]})]})]})});const w=e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[o.actions,e.jsx(t,{variant:"outline-secondary",size:"sm",onClick:()=>k(),disabled:h,title:"Actualiser",children:e.jsx("i",{className:"feather icon-refresh-cw "+(h?"fa-spin":"")})}),p&&e.jsxs("small",{className:"text-muted",children:["Dernière màj: ",p.toLocaleTimeString()]})]});return e.jsx(n,{...o,data:d,loading:h,actions:w})}export{i as D};
